
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Extending Altimeter &#8212; Altimeter  documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="altimeter" href="../modules.html" />
    <link rel="prev" title="Developer’s Guide" href="devguide.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="extending-altimeter">
<h1>Extending Altimeter<a class="headerlink" href="#extending-altimeter" title="Permalink to this headline">¶</a></h1>
<p>Altimeter is designed to be extendable.  Adding new fields for resource types which
are already scanned and graphed is usually straightforward.  Adding new resource types
which are not yet scanned and graphed involves a bit more work but also usually
simple.</p>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>When the Altimeter scan runs (<cite>bin/aws2json.py</cite>) it uses a set of
<code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceSpec</span></code> classes to gather data via AWS APIs (using boto3) and
persist it into an intermediate JSON format which can be converted
to RDF.</p>
<p>Each of these classes must define attributes and methods which define
how exactly data is collected (what boto3 calls, massaging of response
data), how the collected data relates in a graph (a <code class="xref py py-class docutils literal notranslate"><span class="pre">Schema</span></code>) and
taxonomical information (resource type name - e.g. “instance”, resource
service name - e.g. “ec2”).</p>
</div>
<div class="section" id="resource-specs">
<h2>Resource Specs<a class="headerlink" href="#resource-specs" title="Permalink to this headline">¶</a></h2>
<p>Each AWS resource type is represented by a subclass
of <a class="reference internal" href="../altimeter.aws.resource.html#altimeter.aws.resource.resource_spec.AWSResourceSpec" title="altimeter.aws.resource.resource_spec.AWSResourceSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">altimeter.aws.resource.resource_spec.AWSResourceSpec</span></code></a>.</p>
<p>Subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">AWSResourceSpec</span></code> must implement:</p>
<blockquote>
<div><ul class="simple">
<li><p>An attribute <cite>service_name</cite> which should match the name of the resource’s
associated service as represented in an ARN for this resource type.
For instance for EC2 instances this is “ec2” to match the service portion
of ec2 ARNs
“arn:${Partition}:ec2:${Region}:${Account}:instance/${InstanceId}”.</p></li>
<li><p>An attribute <cite>type_name</cite> which should match the type name as represented
in an ARN for this resource type.  For instance, in
<a class="reference internal" href="../altimeter.aws.resource.ec2.html#altimeter.aws.resource.ec2.instance.EC2InstanceResourceSpec" title="altimeter.aws.resource.ec2.instance.EC2InstanceResourceSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">altimeter.aws.resource.ec2.instance.EC2InstanceResourceSpec</span></code></a>
<cite>type_name</cite> is set to “instance” to match the ARN format
“arn:${Partition}:ec2:${Region}:${Account}:instance/${InstanceId}”.</p></li>
<li><p>An attribute <cite>schema</cite> of type <a class="reference internal" href="../altimeter.core.graph.html#altimeter.core.graph.schema.Schema" title="altimeter.core.graph.schema.Schema"><code class="xref py py-class docutils literal notranslate"><span class="pre">altimeter.core.graph.schema.Schema</span></code></a>.
The <cite>schema</cite> attribute describes how to map the output of the boto3 list/describe
api call for this resource into <cite>fields</cite> which define how the resource is graphed.</p></li>
<li><p>A method <code class="xref py py-func docutils literal notranslate"><span class="pre">list_from_aws()</span></code> which performs the describe/list boto3 calls
for this resource, compiles a dictionary with resource ARNs as keys
and resource description dicts as values and wraps them in an
<a class="reference internal" href="../altimeter.aws.resource.html#altimeter.aws.resource.resource_spec.ListFromAWSResult" title="altimeter.aws.resource.resource_spec.ListFromAWSResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">altimeter.aws.resource.resource_spec.ListFromAWSResult</span></code></a> object.</p></li>
</ul>
</div></blockquote>
<p>For each AWSResourceSpec class Altimeter gathers data using <code class="xref py py-func docutils literal notranslate"><span class="pre">list_from_aws()</span></code>
and uses the provided <code class="xref py py-class docutils literal notranslate"><span class="pre">Schema</span></code> object to convert it to intermediate JSON.</p>
<p>At this point it’s instructive to look at an example, the below is an abbreviated
version of
<a class="reference internal" href="../altimeter.aws.resource.ec2.html#altimeter.aws.resource.ec2.instance.EC2InstanceResourceSpec" title="altimeter.aws.resource.ec2.instance.EC2InstanceResourceSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">altimeter.aws.resource.ec2.instance.EC2InstanceResourceSpec</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EC2InstanceResourceSpec</span><span class="p">(</span><span class="n">EC2ResourceSpec</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;instance&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
        <span class="n">TransientResourceLinkField</span><span class="p">(</span><span class="s2">&quot;ImageId&quot;</span><span class="p">,</span> <span class="n">EC2ImageResourceSpec</span><span class="p">),</span>
        <span class="n">ScalarField</span><span class="p">(</span><span class="s2">&quot;InstanceType&quot;</span><span class="p">),</span>
        <span class="n">AnonymousDictField</span><span class="p">(</span><span class="s2">&quot;State&quot;</span><span class="p">,</span> <span class="n">ScalarField</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">)),</span>
        <span class="n">ScalarField</span><span class="p">(</span><span class="s2">&quot;PublicIpAddress&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">ResourceLinkField</span><span class="p">(</span><span class="s2">&quot;VpcId&quot;</span><span class="p">,</span> <span class="n">VPCResourceSpec</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">TagsField</span><span class="p">(),</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_from_aws</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">client</span><span class="p">:</span> <span class="n">BaseClient</span><span class="p">,</span> <span class="n">account_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ListFromAWSResult</span><span class="p">:</span>
        <span class="n">paginator</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s2">&quot;describe_instances&quot;</span><span class="p">)</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">reservation</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Reservations&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">reservation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Instances&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">resource_arn</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">generate_arn</span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;InstanceId&quot;</span><span class="p">])</span>
                    <span class="n">instances</span><span class="p">[</span><span class="n">resource_arn</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="k">return</span> <span class="n">ListFromAWSResult</span><span class="p">(</span><span class="n">resources</span><span class="o">=</span><span class="n">instances</span><span class="p">)</span>
</pre></div>
</div>
<p>As mentioned above, the <cite>type_name</cite> is set to “instance” to match the ARN format of EC2
instances:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;instance&quot;</span>
</pre></div>
</div>
<p>Note that the <cite>service_name</cite> attribute mentioned above is implemented in the parent
class <code class="xref py py-class docutils literal notranslate"><span class="pre">EC2ResourceSpec</span></code> which is a direct subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">AWSResourceSpec</span></code>.</p>
<p>Next lets look at the <code class="xref py py-func docutils literal notranslate"><span class="pre">list_from_aws()</span></code> function.  In general this function should
generate a dictionary representing all resources of this type, where keys are
ARNs and values are dictionaries containing information about the resource:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;resource_1_arn&#39;</span><span class="p">:</span> <span class="n">resource_1_dict</span><span class="p">,</span>
 <span class="s1">&#39;resource_2_arn&#39;</span><span class="p">:</span> <span class="n">resource_2_dict</span><span class="p">,</span>
 <span class="o">...</span><span class="p">}</span>
</pre></div>
</div>
<p>Here is the implementation for our sample <code class="xref py py-class docutils literal notranslate"><span class="pre">EC2ResourceSpec</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">list_from_aws</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">client</span><span class="p">:</span> <span class="n">BaseClient</span><span class="p">,</span> <span class="n">account_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ListFromAWSResult</span><span class="p">:</span>
        <span class="n">paginator</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s2">&quot;describe_instances&quot;</span><span class="p">)</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">reservation</span> <span class="ow">in</span> <span class="n">resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Reservations&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">reservation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Instances&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">resource_arn</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">generate_arn</span><span class="p">(</span><span class="n">account_id</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;InstanceId&quot;</span><span class="p">])</span>
                    <span class="n">instances</span><span class="p">[</span><span class="n">resource_arn</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="k">return</span> <span class="n">ListFromAWSResult</span><span class="p">(</span><span class="n">resources</span><span class="o">=</span><span class="n">instances</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a fairly typical implementation - it uses the appropriate
list/describe boto3 function for this resource type and massages
the data into a dictionary of ARNs to resource dictionaries. It
then returns a <code class="xref py py-class docutils literal notranslate"><span class="pre">ListFromAWSResult</span></code> object which wraps this dictionary.</p>
<p>The dictionary in this case will look something like the below (abbreviated):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s1">&#39;ec2-instance-1-arn&#39;</span><span class="p">:</span>
  <span class="p">{</span> <span class="s1">&#39;AmiLaunchIndex&#39;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
     <span class="s1">&#39;ImageId&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
     <span class="s1">&#39;InstanceId&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
     <span class="s1">&#39;InstanceType&#39;</span><span class="p">:</span> <span class="s1">&#39;t1.micro|t2.nano|t2.micro|t2.small|t2.medium|...&#39;</span><span class="p">,</span>
     <span class="s1">&#39;LaunchTime&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
     <span class="s1">&#39;PublicIpAddress&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
     <span class="s1">&#39;State&#39;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s1">&#39;Code&#39;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
         <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;pending|running|shutting-down|terminated|stopping|stopped&#39;</span>
     <span class="p">},</span>
     <span class="s1">&#39;VpcId&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
     <span class="s1">&#39;Tags&#39;</span><span class="p">:</span> <span class="p">[</span>
         <span class="p">{</span>
             <span class="s1">&#39;Key&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span>
         <span class="p">},</span>
     <span class="p">],</span>
   <span class="p">},</span>
  <span class="s1">&#39;ec2-instance-2-arn&#39;</span><span class="p">:</span>
    <span class="p">{</span> <span class="o">...</span>
    <span class="p">},</span>
   <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally lets examine the schema:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
        <span class="n">TransientResourceLinkField</span><span class="p">(</span><span class="s2">&quot;ImageId&quot;</span><span class="p">,</span> <span class="n">EC2ImageResourceSpec</span><span class="p">),</span>
        <span class="n">ScalarField</span><span class="p">(</span><span class="s2">&quot;InstanceType&quot;</span><span class="p">),</span>
        <span class="n">AnonymousDictField</span><span class="p">(</span><span class="s2">&quot;State&quot;</span><span class="p">,</span> <span class="n">ScalarField</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">)),</span>
        <span class="n">ScalarField</span><span class="p">(</span><span class="s2">&quot;PublicIpAddress&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">ResourceLinkField</span><span class="p">(</span><span class="s2">&quot;VpcId&quot;</span><span class="p">,</span> <span class="n">VPCResourceSpec</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">TagsField</span><span class="p">(),</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Altimeter uses this schema definition to translate the output of <code class="xref py py-func docutils literal notranslate"><span class="pre">list_from_aws()</span></code> into
intermediate JSON.  The intermediate JSON contains graph relational information
about the object and its attributes.</p>
<p>A Schema consists of a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code> objects.  In this case we are using a few
different kinds of fields.  For all but one (<code class="xref py py-class docutils literal notranslate"><span class="pre">TagsField</span></code>) the first argument
is a key as returned by <code class="xref py py-func docutils literal notranslate"><span class="pre">list_from_aws()</span></code>. This argument is known as the
<cite>source_key</cite>.</p>
<p>For example line 5 contains a <code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarField</span></code> which uses the <cite>source_key</cite>
“InstanceType”.  <code class="xref py py-class docutils literal notranslate"><span class="pre">ScalarField</span></code> is the simplest kind of field, it is used
when a value is a simple string with no relational data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="n">ScalarField</span><span class="p">(</span><span class="s2">&quot;InstanceType&quot;</span><span class="p">),</span>
</pre></div>
</div>
<p>Line 8 contains a slightly less simple field type - <code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceLinkField</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="n">ResourceLinkField</span><span class="p">(</span><span class="s2">&quot;VpcId&quot;</span><span class="p">,</span> <span class="n">VPCResourceSpec</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</pre></div>
</div>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceLinkField</span></code> is a field where the value contains the ID of another
resource which is also in the graph.  Since we also graph VPCs using the
<code class="xref py py-class docutils literal notranslate"><span class="pre">VPCResourceSpec</span></code> type, we can represent a link between an EC2 instance
and its correseponding VPC using a <code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceLinkField</span></code> on the parent
(<code class="xref py py-class docutils literal notranslate"><span class="pre">EC2ResourceSpec</span></code>) referencing the child (<code class="xref py py-class docutils literal notranslate"><span class="pre">VPCResourceSpec</span></code>) as the second
argument of the <code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceLinkField</span></code>.  Note that there is an additional keyword
argument <cite>optional</cite> which indicates this field does not always appear.</p>
<p>The various types of fields and how they are used are documented in the API
documentation, see <a class="reference internal" href="../altimeter.core.graph.field.html"><span class="doc">altimeter.core.graph.field</span></a>.
Numerous examples of their use are also provided in the <code class="xref py py-class docutils literal notranslate"><span class="pre">AWSResourceSpec</span></code> subclasses
in <cite>altimeter/aws/resource</cite>.</p>
</div>
<div class="section" id="modifying-an-existing-resource-type">
<h2>Modifying an Existing Resource Type<a class="headerlink" href="#modifying-an-existing-resource-type" title="Permalink to this headline">¶</a></h2>
<p>Note that the Schema of an <code class="xref py py-class docutils literal notranslate"><span class="pre">AWSResourceSpec</span></code> subclass does not necessarily include
all the data that is in the output of <code class="xref py py-func docutils literal notranslate"><span class="pre">list_from_aws()</span></code>.  Some keys are just not all that
interesting to us at this time and are not worth graphing. In general we
add new fields in the graph as we need them.</p>
<p>Adding a new field is as simple as adding a new <code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code> object to the
<code class="xref py py-class docutils literal notranslate"><span class="pre">AWSResourceSpec</span></code>’s <cite>schema</cite> attribute. For example, if we would additionally
like to graph the subnet of an ec2 instance we could add a field to pull the <cite>SubnetId</cite> field
which is provided in the <cite>describe_instances</cite> call in <code class="xref py py-func docutils literal notranslate"><span class="pre">list_from_aws()</span></code>. Since we
have an <code class="xref py py-class docutils literal notranslate"><span class="pre">AWSResourceSpec</span></code> class for subnets (<code class="xref py py-class docutils literal notranslate"><span class="pre">SubnetResourceSpec</span></code>) we
can use a <code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceLinkField</span></code>. The schema now looks like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">schema</span> <span class="o">=</span> <span class="n">Schema</span><span class="p">(</span>
        <span class="n">TransientResourceLinkField</span><span class="p">(</span><span class="s2">&quot;ImageId&quot;</span><span class="p">,</span> <span class="n">EC2ImageResourceSpec</span><span class="p">),</span>
        <span class="n">ScalarField</span><span class="p">(</span><span class="s2">&quot;InstanceType&quot;</span><span class="p">),</span>
        <span class="n">AnonymousDictField</span><span class="p">(</span><span class="s2">&quot;State&quot;</span><span class="p">,</span> <span class="n">ScalarField</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">)),</span>
        <span class="n">ScalarField</span><span class="p">(</span><span class="s2">&quot;PublicIpAddress&quot;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">ResourceLinkField</span><span class="p">(</span><span class="s2">&quot;VpcId&quot;</span><span class="p">,</span> <span class="n">VPCResourceSpec</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="hll">        <span class="n">ResourceLinkField</span><span class="p">(</span><span class="s2">&quot;SubnetId&quot;</span><span class="p">,</span> <span class="n">SubnetResourceSpec</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span>        <span class="n">TagsField</span><span class="p">(),</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>As with the VPC field the new subnet field has the <cite>optional</cite> flag set as not all EC2 instances
have subnets.</p>
</div>
<div class="section" id="testing-changes">
<h2>Testing Changes<a class="headerlink" href="#testing-changes" title="Permalink to this headline">¶</a></h2>
<p>The quickest way to test a change is to use the provided <cite>bin/scan_resource.py</cite> script.
This script will run a scan of a single <code class="xref py py-class docutils literal notranslate"><span class="pre">AWSResourceSpec</span></code> class against a
single specified AWS region using the currently configured AWS credential profile and
write scan output to STDOUT. For example after the subnet addition above,
running</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">/</span><span class="n">scan_resource</span><span class="o">.</span><span class="n">py</span> <span class="n">EC2InstanceResourceSpec</span> <span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>in an account <cite>012345678901</cite> with a single ec2 instance could return something like:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;aws:ec2:instance&quot;</span><span class="p">,</span>
      <span class="s2">&quot;link_collection&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;simple_links&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;pred&quot;</span><span class="p">:</span> <span class="s2">&quot;instance_type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;obj&quot;</span><span class="p">:</span> <span class="s2">&quot;t2.2xlarge&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&quot;pred&quot;</span><span class="p">:</span> <span class="s2">&quot;state&quot;</span><span class="p">,</span>
            <span class="s2">&quot;obj&quot;</span><span class="p">:</span> <span class="s2">&quot;stopped&quot;</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;multi_links&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
        <span class="s2">&quot;tag_links&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;pred&quot;</span><span class="p">:</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;obj&quot;</span><span class="p">:</span> <span class="s2">&quot;my-instance&quot;</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;resource_links&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;pred&quot;</span><span class="p">:</span> <span class="s2">&quot;vpc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;obj&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:ec2:us-west-2:012345678901:vpc/vpc-01234567890abcdef&quot;</span><span class="p">,</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&quot;pred&quot;</span><span class="p">:</span> <span class="s2">&quot;subnet&quot;</span><span class="p">,</span>
            <span class="s2">&quot;obj&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:ec2:us-west-2:012345678901:subnet/subnet-abcdef01234567890&quot;</span><span class="p">,</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;transient_resource_links&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;pred&quot;</span><span class="p">:</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span>
            <span class="s2">&quot;obj&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:ec2:us-east-1:012345678901:image/ami-abcd1234&quot;</span><span class="p">,</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="adding-a-new-awsresourcespec">
<h2>Adding a New AWSResourceSpec<a class="headerlink" href="#adding-a-new-awsresourcespec" title="Permalink to this headline">¶</a></h2>
<p>Adding a new resource type to the graph consists of adding a new class which is
a subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">AWSResourceSpec</span></code>.</p>
<p>These classes live in <a class="reference internal" href="../altimeter.aws.resource.html#module-altimeter.aws.resource" title="altimeter.aws.resource"><code class="xref py py-mod docutils literal notranslate"><span class="pre">altimeter.aws.resource</span></code></a>. They are organized by AWS service
(e.g. “ec2”, “rds”, “s3”, etc).</p>
<p>The service packages (for instance <a class="reference internal" href="../altimeter.aws.resource.ec2.html#module-altimeter.aws.resource.ec2" title="altimeter.aws.resource.ec2"><code class="xref py py-mod docutils literal notranslate"><span class="pre">altimeter.aws.resource.ec2</span></code></a>) define a subclass
of <code class="xref py py-class docutils literal notranslate"><span class="pre">AWSResourceSpec</span></code> which sets the <cite>service_name</cite> attribute.  In the case of
ec2 this is <a class="reference internal" href="../altimeter.aws.resource.ec2.html#altimeter.aws.resource.ec2.EC2ResourceSpec" title="altimeter.aws.resource.ec2.EC2ResourceSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">altimeter.aws.resource.ec2.EC2ResourceSpec</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;AWSResourceSpec subclass for ec2 resources.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">altimeter.aws.resource.resource_spec</span> <span class="kn">import</span> <span class="n">AWSResourceSpec</span>


<span class="k">class</span> <span class="nc">EC2ResourceSpec</span><span class="p">(</span><span class="n">AWSResourceSpec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;AWSResourceSpec subclass for ec2 resources.&quot;&quot;&quot;</span>

    <span class="n">service_name</span> <span class="o">=</span> <span class="s2">&quot;ec2&quot;</span>
</pre></div>
</div>
<p>If the resource you wish to add is not within a service already defined under <a class="reference internal" href="../altimeter.aws.resource.html#module-altimeter.aws.resource" title="altimeter.aws.resource"><code class="xref py py-mod docutils literal notranslate"><span class="pre">altimeter.aws.resource</span></code></a>
you will need to create a class similar to the <code class="xref py py-class docutils literal notranslate"><span class="pre">EC2ResourceSpec</span></code> class above.</p>
<p>When adding a new <code class="xref py py-class docutils literal notranslate"><span class="pre">AWSResourceSpec</span></code> subclass there are a few things you will need to do:</p>
<ul class="simple">
<li><p>As alluded to above your class should subclass an existing service-level <code class="xref py py-class docutils literal notranslate"><span class="pre">AWSResourceSpec</span></code> class,
for example <code class="xref py py-class docutils literal notranslate"><span class="pre">EC2ResourceSpec</span></code>.</p></li>
<li><p>Set the <cite>type_name</cite> attribute using the name as presented in an ARN of the specific resource type (e.g. <cite>instance</cite>).</p></li>
<li><p>Implement <code class="xref py py-func docutils literal notranslate"><span class="pre">list_from_aws()</span></code> to gather data and produce a <code class="xref py py-class docutils literal notranslate"><span class="pre">ListFromAWSResult</span></code>.</p></li>
<li><p>Set the <cite>schema</cite> attribute to a <code class="xref py py-class docutils literal notranslate"><span class="pre">Schema</span></code> object with the appropriate fields.</p></li>
<li><p>Add your class to <code class="xref py py-mod docutils literal notranslate"><span class="pre">altimeter.aws.scan.settings.RESOURCE_SPEC_CLASSES</span></code>. This contains a list of enabled
scan resource types.</p></li>
<li><p>Test using <cite>bin/scan_resource.py</cite>.</p></li>
<li><p>Add tests for the new type in <code class="xref py py-mod docutils literal notranslate"><span class="pre">tests.unit.altimeter.aws.resource</span></code>, preferably using moto. See examples
in <code class="xref py py-mod docutils literal notranslate"><span class="pre">tests.unit.altimeter.aws.resource.ec2</span></code> for examples of such tests.</p></li>
</ul>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Altimeter</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/local_blazegraph.html">Local Querying with Blazegraph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/sample_queries.html">Sample Queries</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="devguide.html">Developer’s Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Extending Altimeter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resource-specs">Resource Specs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modifying-an-existing-resource-type">Modifying an Existing Resource Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-changes">Testing Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-new-awsresourcespec">Adding a New AWSResourceSpec</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">altimeter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../altimeter.aws.html">altimeter.aws package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../altimeter.core.html">altimeter.core package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="devguide.html" title="previous chapter">Developer’s Guide</a></li>
      <li>Next: <a href="../modules.html" title="next chapter">altimeter</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Tableau.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/dev/extending.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>